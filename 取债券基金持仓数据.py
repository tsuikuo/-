# -*- coding: utf-8 -*-
"""
获取所有基金持仓的前十债券wind代码和对应的持仓市值
可现在万得中添加板块然后代码生成器自动生成公式
"""

from WindPy import w
import numpy as np
import pandas as pd
#取数据
w.start()
df=pd.DataFrame()
for ord in range(10):
    var="rptDate=20170630;order="+str(ord+1)+";unit=1"
    fund=w.wss("110027.OF,050019.OF,217018.OF,003135.OF,161010.OF,002969.OF,620003.OF,470058.OF,519977.OF,003133.OF,002866.OF,000810.OF,001367.OF,001045.OF,000045.OF,001862.OF,100035.OF,001031.OF,000171.OF,350006.OF,630007.OF,003109.OF,002351.OF,050011.OF,002677.OF,000973.OF,002651.OF,003612.OF,002701.OF,110017.OF,002551.OF,100051.OF,004033.OF,003573.OF,001854.OF,003401.OF,003236.OF,000385.OF,002842.OF,164105.OF,519654.OF,001257.OF,080003.OF,003126.OF,003197.OF,550004.OF,002636.OF,163816.OF,002361.OF,519121.OF,001920.OF,121012.OF,000466.OF,002355.OF,040022.OF,000207.OF,000377.OF,002749.OF,002932.OF,530020.OF,004102.OF,003218.OF,004024.OF,040009.OF,002887.OF,519160.OF,003747.OF,004124.OF,202105.OF,002961.OF,485114.OF,003898.OF,630009.OF,162108.OF,003176.OF,519328.OF,206018.OF,261002.OF,002478.OF,470018.OF,000118.OF,003188.OF,002474.OF,003978.OF,161216.OF,002719.OF,003504.OF,000122.OF,002925.OF,550018.OF,000111.OF,240018.OF,000181.OF,320021.OF,410004.OF,519631.OF,519123.OF,002922.OF,003660.OF,000341.OF,004463.OF,110007.OF,180025.OF,003390.OF,004021.OF,000236.OF,002506.OF,003852.OF,004141.OF,165807.OF,000128.OF,002138.OF,002765.OF,519330.OF,003716.OF,206015.OF,002755.OF,004127.OF,002421.OF,003371.OF,519128.OF,004087.OF,004323.OF,004034.OF,004063.OF,180015.OF,002988.OF,001086.OF,160718.OF,002274.OF,003742.OF,004445.OF,003101.OF,003888.OF,003450.OF,004459.OF,000147.OF,003672.OF,050016.OF,003853.OF,000629.OF,002065.OF,000914.OF,003627.OF,002586.OF,004122.OF,004123.OF,380009.OF,160130.OF,003407.OF,000345.OF,161015.OF,003770.OF,002736.OF,003417.OF,002742.OF,470088.OF,002501.OF,003167.OF,003952.OF,004388.OF,519152.OF,161626.OF,000360.OF,003315.OF,002920.OF,003341.OF,003306.OF,519332.OF,003605.OF,270044.OF,003899.OF,003448.OF,003650.OF,004134.OF,003428.OF,003767.OF,217011.OF,004180.OF,166008.OF,002684.OF,002815.OF,003192.OF,003671.OF,002306.OF,003424.OF,001035.OF,002904.OF,004254.OF,004322.OF,002864.OF,004079.OF,003265.OF,000237.OF,003691.OF,003547.OF,540001.OF,000875.OF,003226.OF,002554.OF,003999.OF,002965.OF,004395.OF,003963.OF,002215.OF,003728.OF,004089.OF,003406.OF,003290.OF,003847.OF,002798.OF,003419.OF,121009.OF,003836.OF,003221.OF,160621.OF,004438.OF,519786.OF,160622.OF,750002.OF,003811.OF,002342.OF,004441.OF,004061.OF,003614.OF,003668.OF,004242.OF,164302.OF,003583.OF,519136.OF,003211.OF,002336.OF,002725.OF,004366.OF,003220.OF,519740.OF,002867.OF,001847.OF,002377.OF,004159.OF,004118.OF,004499.OF,004031.OF,166003.OF,700005.OF,003673.OF,002447.OF,070020.OF,160618.OF,003210.OF,003837.OF,003400.OF,050023.OF,519322.OF,003681.OF,002840.OF,003461.OF,003532.OF,000435.OF,002901.OF,003024.OF,004264.OF,165517.OF,003639.OF,003207.OF,000310.OF,003394.OF,000419.OF,003530.OF,000937.OF,003452.OF,167501.OF,000801.OF,020019.OF,003336.OF,002578.OF,003680.OF,003675.OF,002276.OF,002337.OF,004230.OF,003313.OF,003427.OF,003011.OF,002711.OF,004030.OF,002523.OF,000139.OF,000225.OF,003528.OF,310508.OF,003976.OF,001246.OF,002568.OF,001750.OF,002442.OF,519324.OF,003156.OF,090002.OF,002964.OF,004200.OF,000781.OF,003360.OF,003277.OF,000221.OF,003936.OF,001911.OF,001945.OF,519662.OF,003640.OF,660002.OF,233005.OF,003682.OF,519208.OF,000064.OF,001819.OF,000005.OF,000469.OF,100018.OF,003741.OF,003179.OF,161014.OF,000174.OF,003286.OF,650001.OF,161505.OF,003557.OF,003429.OF,000054.OF,003708.OF,160602.OF,003743.OF,003037.OF,000744.OF,160217.OF,002466.OF,070005.OF,000465.OF,000239.OF,519782.OF,003454.OF,004066.OF,004108.OF,002245.OF,003733.OF,003050.OF,000319.OF,003526.OF,000257.OF,001961.OF,003590.OF,000415.OF,519225.OF,000116.OF,002452.OF,003497.OF,001575.OF,003574.OF,002985.OF,003487.OF,163819.OF,519774.OF,002632.OF,003628.OF,002971.OF,675100.OF,000501.OF,002650.OF,004469.OF,501100.OF,003039.OF,164902.OF,519776.OF,675041.OF,003730.OF,001794.OF,002688.OF,164606.OF,000503.OF,004027.OF,003369.OF,002625.OF,519723.OF,000655.OF,003674.OF,003287.OF,002915.OF,002354.OF,288102.OF,000113.OF,050006.OF,001859.OF,003902.OF,003420.OF,004038.OF,070037.OF,161614.OF,217022.OF,003395.OF,001776.OF,003051.OF,004386.OF,003866.OF,340009.OF,000338.OF,510080.OF,004168.OF,002499.OF,164703.OF,000736.OF,002997.OF,400009.OF,002549.OF,675011.OF,003324.OF,371020.OF,003746.OF,000406.OF,400027.OF,003087.OF,320008.OF,270048.OF,003469.OF,003195.OF,002508.OF,450018.OF,002109.OF,000510.OF,002825.OF,002278.OF,003289.OF,001912.OF,000235.OF,003214.OF,003078.OF,004334.OF,003041.OF,519762.OF,003382.OF,003337.OF,519206.OF,164509.OF,003576.OF,000177.OF,000183.OF,002143.OF,002265.OF,002550.OF,002830.OF,165509.OF,164210.OF,040036.OF,002986.OF,002898.OF,002924.OF,519199.OF,160131.OF,002734.OF,000931.OF,000107.OF,003199.OF,003648.OF,000105.OF,100072.OF,000752.OF,530008.OF,261001.OF,003073.OF,050028.OF,000205.OF,000191.OF,001011.OF,002929.OF,003021.OF,519210.OF,660013.OF,004045.OF,002600.OF,004093.OF,002481.OF,162215.OF,166012.OF,003280.OF,610008.OF,002641.OF,002991.OF,675091.OF,270009.OF,530021.OF,003178.OF,160720.OF,001546.OF,610003.OF,003546.OF,003121.OF,004203.OF,270029.OF,002524.OF,002198.OF,002169.OF,002569.OF,519061.OF,003260.OF,620009.OF,002869.OF,003457.OF,003618.OF,001235.OF,163806.OF,530017.OF,519326.OF,001299.OF,002491.OF,519632.OF,002486.OF,206003.OF,002552.OF,000997.OF,519941.OF,003983.OF,002994.OF,519676.OF,003258.OF,004307.OF,003826.OF,000137.OF,002008.OF,003568.OF,003989.OF,002781.OF,004020.OF,002948.OF,001160.OF,000143.OF,001993.OF,003268.OF,002896.OF,003273.OF,164208.OF,000896.OF,000032.OF,003662.OF,003987.OF,000329.OF,000265.OF,003009.OF,000149.OF,003349.OF,002756.OF,002946.OF,002532.OF,040019.OF,003726.OF,000271.OF,003213.OF,000024.OF,000421.OF,003607.OF,000302.OF,001999.OF,519334.OF,002795.OF,003056.OF,000015.OF,530009.OF,002805.OF,519162.OF,000201.OF,001918.OF,003418.OF,370025.OF,161119.OF,002140.OF,004140.OF,000069.OF,003301.OF,161716.OF,110037.OF,161603.OF,002996.OF,310378.OF,163907.OF,002998.OF,519945.OF,000561.OF,040012.OF,163005.OF,003651.OF,519230.OF,003520.OF,003159.OF,001948.OF,161713.OF,000130.OF,003146.OF,519973.OF,240012.OF,460008.OF,001963.OF,004117.OF,164206.OF,002796.OF,000355.OF,000022.OF,001578.OF,004001.OF,003517.OF,000303.OF,162712.OF,090008.OF,161820.OF,002817.OF,002868.OF,002826.OF,002218.OF,003564.OF,003566.OF,002254.OF,000911.OF,000197.OF,002483.OF,000026.OF,004104.OF,003013.OF,000489.OF,000295.OF,162210.OF,519953.OF,003867.OF,200013.OF,002528.OF,000372.OF,519226.OF,161823.OF,002940.OF,003094.OF,003425.OF,000395.OF,003652.OF,003102.OF,003522.OF,003664.OF,002858.OF,003329.OF,202108.OF,519947.OF,001545.OF,002992.OF,519622.OF,000014.OF,166105.OF,000694.OF,002188.OF,002751.OF,002738.OF,003705.OF,000200.OF,001751.OF,001061.OF,001055.OF,400030.OF,519118.OF,002811.OF,002761.OF,519955.OF,003514.OF,002073.OF,001960.OF,003091.OF,003445.OF,003381.OF,519669.OF,003409.OF,003309.OF,100066.OF,003099.OF,003776.OF,003440.OF,202102.OF,002206.OF,004295.OF,165809.OF,000289.OF,213007.OF,000244.OF,003466.OF,217003.OF,004458.OF,519680.OF,003259.OF,003863.OF,003162.OF,163003.OF,003929.OF,000186.OF,290003.OF,165311.OF,050027.OF,002927.OF,002807.OF,004059.OF,002438.OF,002698.OF,519718.OF,000351.OF,163811.OF,001019.OF,000212.OF,000227.OF,000298.OF,000086.OF,001906.OF,164808.OF,160612.OF,003107.OF,003471.OF,003833.OF,003545.OF,003209.OF,004032.OF,003023.OF,001199.OF,003832.OF,485119.OF,000889.OF,070009.OF,003549.OF,003571.OF,002661.OF,003092.OF,270043.OF,003982.OF,003789.OF,002754.OF,002487.OF,000817.OF,161117.OF,000497.OF,003089.OF,002775.OF,519078.OF,020002.OF,485105.OF,003442.OF,003500.OF,519989.OF,000277.OF,004136.OF,162715.OF,002750.OF,360008.OF,004106.OF,003575.OF,163824.OF,002579.OF,686868.OF,003223.OF,002970.OF,002279.OF,003163.OF,000563.OF,380005.OF,217023.OF,253020.OF,003569.OF,000943.OF,519220.OF,003809.OF,519967.OF,003527.OF,240003.OF,519730.OF,004419.OF,000252.OF,004052.OF,003254.OF,003285.OF,002445.OF,000053.OF,000305.OF,003239.OF,519683.OF,003438.OF,003488.OF,000402.OF,540005.OF,002930.OF,519660.OF,000074.OF,000728.OF,253060.OF,002476.OF,004400.OF,002268.OF,002607.OF,000194.OF,002674.OF,003949.OF,002395.OF,485107.OF,519186.OF,002720.OF,003358.OF,004246.OF,206008.OF,000184.OF,420008.OF,040026.OF,003731.OF,003793.OF,002356.OF,001952.OF,002635.OF,001369.OF,002048.OF,002870.OF,233012.OF,002877.OF,003384.OF,100050.OF,000067.OF,200009.OF,690006.OF,400016.OF,002521.OF,002570.OF,002400.OF,000290.OF,000267.OF,360013.OF,161618.OF,000047.OF,003824.OF,002391.OF,003891.OF,002397.OF,003314.OF,519933.OF,470010.OF,485111.OF,002638.OF,002916.OF,003486.OF,002426.OF,420002.OF,000623.OF,002782.OF,002909.OF,001021.OF,161902.OF,001512.OF,000202.OF,003376.OF,002519.OF,003795.OF,630003.OF,160915.OF,070025.OF,000254.OF,000078.OF,166022.OF,511220.OF,003155.OF,000333.OF,000668.OF,162105.OF,519057.OF,320004.OF,000007.OF,690002.OF,003327.OF,164814.OF,370021.OF,003463.OF,450005.OF,000437.OF,519666.OF,002832.OF,002693.OF,000583.OF,100058.OF,000246.OF,000280.OF,070033.OF,000286.OF,002704.OF,003892.OF,160514.OF,160617.OF,040045.OF,002448.OF,070015.OF,050030.OF,003814.OF,002723.OF,040040.OF,161826.OF,001001.OF,519051.OF,004085.OF,003972.OF,003703.OF,519937.OF,000463.OF,004318.OF,003385.OF,003817.OF,002286.OF,000274.OF,002548.OF,000292.OF,003123.OF,501300.OF,000578.OF,519030.OF,002603.OF,003097.OF,003819.OF,675121.OF,002785.OF,164812.OF,573003.OF,217008.OF,003334.OF,001779.OF,000412.OF,000103.OF,161719.OF,003046.OF,003551.OF,590009.OF,000546.OF,000473.OF,519939.OF,519320.OF,160513.OF,000552.OF,395011.OF,519985.OF,166010.OF,003342.OF,161115.OF", "prt_topbondwindcode,prt_topbondvalue",var)
    dfi=pd.DataFrame(np.transpose(fund.Data),columns=fund.Fields)
    df=pd.concat([df,dfi])
#数据清理，分类汇总，按照债券wind代码把相同债券的持仓市值
df=df.dropna(how='any')
df.replace([None],0)
df=df.groupby('PRT_TOPBONDWINDCODE')['PRT_TOPBONDVALUE'].sum()
df=df.to_frame()
df['PRT_TOPBONDWINDCODE'] =df.index
df =df.reset_index(drop= True)
#保存数据
df.to_csv('G:\兴业\债券基金持仓数据.csv')